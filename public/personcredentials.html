<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Management - Order Management System</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom CSS -->
    <link href="styles.css" rel="stylesheet">

    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üîê</text></svg>">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg">
        <div class="container-fluid">
            <a class="navbar-brand" href="index.html">
                üì¶ Order Management System
            </a>

            <div class="navbar-nav ms-auto">
                <a class="nav-link" href="index.html">Orders</a>
                <a class="nav-link" href="persons.html">Persons</a>
                <a class="nav-link active" href="personcredentials.html">User Management</a>
                <a class="nav-link" href="continents.html">Continents</a>
                <a class="nav-link" href="languages.html">Languages</a>
                <a class="nav-link" href="countries.html">Countries</a>

                <div class="nav-item d-flex align-items-center me-3 ms-3">
                    <span class="connection-status connected"></span>
                    <small class="text-muted">Real-time</small>
                </div>

                <button id="themeToggle" class="theme-toggle me-2">
                    üåô
                </button>

                <button id="refreshCredentials" class="btn btn-outline-primary btn-sm">
                    <span id="loadingIndicator" class="loading-spinner" style="display: none;"></span>
                    Refresh
                </button>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container-fluid py-4">
        <!-- Header -->
        <div class="row mb-4">
            <div class="col-md-8">
                <h1 class="h3 mb-0">üîê User Management</h1>
                <p class="text-muted">Manage user credentials with security features</p>
            </div>
            <div class="col-md-4 text-end">
                <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addCredentialModal">
                    <i class="bi bi-plus-circle"></i> Add User Account
                </button>
            </div>
        </div>

        <!-- Statistics Cards -->
        <div class="row mb-4">
            <div class="col-md-3">
                <div class="card stats-card">
                    <div class="card-body">
                        <div class="d-flex justify-content-between">
                            <div>
                                <h6 class="card-subtitle mb-2">Total Accounts</h6>
                                <h4 class="card-title mb-0" id="totalCredentials">0</h4>
                            </div>
                            <div class="stats-icon">üë•</div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card stats-card">
                    <div class="card-body">
                        <div class="d-flex justify-content-between">
                            <div>
                                <h6 class="card-subtitle mb-2">Active</h6>
                                <h4 class="card-title mb-0" id="activeCredentials">0</h4>
                            </div>
                            <div class="stats-icon">‚úÖ</div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card stats-card">
                    <div class="card-body">
                        <div class="d-flex justify-content-between">
                            <div>
                                <h6 class="card-subtitle mb-2">Locked</h6>
                                <h4 class="card-title mb-0" id="lockedCredentials">0</h4>
                            </div>
                            <div class="stats-icon">üîí</div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card stats-card">
                    <div class="card-body">
                        <div class="d-flex justify-content-between">
                            <div>
                                <h6 class="card-subtitle mb-2">Recent Logins</h6>
                                <h4 class="card-title mb-0" id="recentLogins">0</h4>
                            </div>
                            <div class="stats-icon">üïí</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Credentials Table -->
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0">User Accounts</h5>
                <div class="d-flex gap-2">
                    <input type="search" id="searchCredentials" class="form-control form-control-sm" placeholder="Search users..." style="width: 200px;">
                    <select id="statusFilter" class="form-select form-select-sm" style="width: 120px;">
                        <option value="">All Status</option>
                        <option value="active">Active</option>
                        <option value="inactive">Inactive</option>
                        <option value="locked">Locked</option>
                    </select>
                </div>
            </div>
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table table-hover mb-0">
                        <thead class="table-light">
                            <tr>
                                <th>ID</th>
                                <th>Username</th>
                                <th>Person</th>
                                <th>Last Login</th>
                                <th>Login Attempts</th>
                                <th>Status</th>
                                <th>Created</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="credentialsTableBody">
                            <tr>
                                <td colspan="8" class="text-center py-4">
                                    <div class="spinner-border text-primary" role="status">
                                        <span class="visually-hidden">Loading...</span>
                                    </div>
                                    <div class="mt-2">Loading user accounts...</div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Credential Modal -->
    <div class="modal fade" id="addCredentialModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Add New User Account</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <form id="addCredentialForm">
                    <div class="modal-body">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="personId" class="form-label">Person *</label>
                                    <select class="form-select" id="personId" name="person_id" required>
                                        <option value="">Select a person...</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="username" class="form-label">Username *</label>
                                    <input type="text" class="form-control" id="username" name="username" required>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="password" class="form-label">Password *</label>
                                    <input type="password" class="form-control" id="password" name="password" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="confirmPassword" class="form-label">Confirm Password *</label>
                                    <input type="password" class="form-control" id="confirmPassword" name="confirm_password" required>
                                </div>
                            </div>
                        </div>

                        <!-- Security Questions -->
                        <h6 class="mt-4 mb-3">Security Questions</h6>
                        <div class="mb-3">
                            <label for="securityQuestion1" class="form-label">Security Question 1</label>
                            <input type="text" class="form-control" id="securityQuestion1" name="security_question_1" placeholder="e.g., What is your mother's maiden name?">
                        </div>
                        <div class="mb-3">
                            <label for="securityAnswer1" class="form-label">Answer 1</label>
                            <input type="text" class="form-control" id="securityAnswer1" name="security_answer_1">
                        </div>

                        <div class="mb-3">
                            <label for="securityQuestion2" class="form-label">Security Question 2</label>
                            <input type="text" class="form-control" id="securityQuestion2" name="security_question_2" placeholder="e.g., What was your first pet's name?">
                        </div>
                        <div class="mb-3">
                            <label for="securityAnswer2" class="form-label">Answer 2</label>
                            <input type="text" class="form-control" id="securityAnswer2" name="security_answer_2">
                        </div>

                        <div class="mb-3">
                            <label for="securityQuestion3" class="form-label">Security Question 3</label>
                            <input type="text" class="form-control" id="securityQuestion3" name="security_question_3" placeholder="e.g., What city were you born in?">
                        </div>
                        <div class="mb-3">
                            <label for="securityAnswer3" class="form-label">Answer 3</label>
                            <input type="text" class="form-control" id="securityAnswer3" name="security_answer_3">
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-primary">Create Account</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- View Details Modal -->
    <div class="modal fade" id="viewDetailsModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">User Account Details</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" id="detailsContent">
                    <!-- Content will be populated by JavaScript -->
                </div>
                <div class="modal-footer" id="detailsActions">
                    <!-- Actions will be populated by JavaScript -->
                </div>
            </div>
        </div>
    </div>

    <!-- Password Reset Modal -->
    <div class="modal fade" id="passwordResetModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Reset Password</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <form id="passwordResetForm">
                    <input type="hidden" id="resetCredentialId">
                    <div class="modal-body">
                        <div class="mb-3">
                            <label for="newPassword" class="form-label">New Password *</label>
                            <input type="password" class="form-control" id="newPassword" name="new_password" required>
                        </div>
                        <div class="mb-3">
                            <label for="confirmNewPassword" class="form-label">Confirm New Password *</label>
                            <input type="password" class="form-control" id="confirmNewPassword" name="confirm_new_password" required>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-danger">Reset Password</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Custom JS -->
    <script src="app.js"></script>

    <script>
        // Person Credential Management System
        class PersonCredentialManager {
            constructor() {
                this.credentials = [];
                this.persons = [];
                this.filteredCredentials = [];
                this.init();
            }

            init() {
                this.bindEvents();
                this.loadPersons();
                this.loadCredentials();
            }

            bindEvents() {
                // Refresh button
                document.getElementById('refreshCredentials').addEventListener('click', () => {
                    this.loadCredentials();
                });

                // Search
                document.getElementById('searchCredentials').addEventListener('input', (e) => {
                    this.filterCredentials();
                });

                // Status filter
                document.getElementById('statusFilter').addEventListener('change', (e) => {
                    this.filterCredentials();
                });

                // Add credential form
                document.getElementById('addCredentialForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.addCredential();
                });

                // Password reset form
                document.getElementById('passwordResetForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.resetPassword();
                });
            }

            async loadPersons() {
                try {
                    const response = await fetch('/api/entities/Person');
                    const result = await response.json();

                    if (result.success) {
                        this.persons = result.data || [];
                        this.populatePersonSelect();
                    }
                } catch (error) {
                    console.error('Error loading persons:', error);
                }
            }

            populatePersonSelect() {
                const select = document.getElementById('personId');
                select.innerHTML = '<option value="">Select a person...</option>';

                this.persons.forEach(person => {
                    const option = document.createElement('option');
                    option.value = person.id;
                    option.textContent = `${person.first_name} ${person.last_name} (${person.email})`;
                    select.appendChild(option);
                });
            }

            async loadCredentials() {
                try {
                    const loadingIndicator = document.getElementById('loadingIndicator');
                    loadingIndicator.style.display = 'inline-block';

                    const response = await fetch('/api/entities/PersonCredential');
                    const result = await response.json();

                    if (result.success) {
                        this.credentials = result.data || [];
                        this.filteredCredentials = [...this.credentials];
                        this.renderCredentials();
                        this.updateStatistics();
                    } else {
                        throw new Error(result.error || 'Failed to load credentials');
                    }
                } catch (error) {
                    console.error('Error loading credentials:', error);
                    this.showError('Failed to load user accounts: ' + error.message);
                } finally {
                    document.getElementById('loadingIndicator').style.display = 'none';
                }
            }

            filterCredentials() {
                const searchTerm = document.getElementById('searchCredentials').value.toLowerCase();
                const statusFilter = document.getElementById('statusFilter').value;

                this.filteredCredentials = this.credentials.filter(credential => {
                    const person = this.persons.find(p => p.id == credential.person_id);
                    const personName = person ? `${person.first_name} ${person.last_name}` : '';

                    const matchesSearch = !searchTerm ||
                        credential.username.toLowerCase().includes(searchTerm) ||
                        personName.toLowerCase().includes(searchTerm);

                    let status = 'inactive';
                    if (credential.is_active == 1) {
                        status = this.isLocked(credential) ? 'locked' : 'active';
                    }

                    const matchesStatus = !statusFilter || status === statusFilter;

                    return matchesSearch && matchesStatus;
                });

                this.renderCredentials();
            }

            isLocked(credential) {
                return credential.locked_until && new Date(credential.locked_until) > new Date();
            }

            renderCredentials() {
                const tbody = document.getElementById('credentialsTableBody');

                if (this.filteredCredentials.length === 0) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="8" class="text-center py-4">
                                <div class="text-muted">No user accounts found</div>
                            </td>
                        </tr>
                    `;
                    return;
                }

                tbody.innerHTML = this.filteredCredentials.map(credential => {
                    const person = this.persons.find(p => p.id == credential.person_id);
                    const personName = person ? `${person.first_name} ${person.last_name}` : 'Unknown';

                    let status = 'inactive';
                    let statusBadge = '<span class="badge bg-secondary">Inactive</span>';

                    if (credential.is_active == 1) {
                        if (this.isLocked(credential)) {
                            status = 'locked';
                            statusBadge = '<span class="badge bg-danger">Locked</span>';
                        } else {
                            status = 'active';
                            statusBadge = '<span class="badge bg-success">Active</span>';
                        }
                    }

                    const lastLogin = credential.last_login
                        ? new Date(credential.last_login).toLocaleDateString() + ' ' + new Date(credential.last_login).toLocaleTimeString()
                        : 'Never';

                    return `
                        <tr>
                            <td>${credential.id}</td>
                            <td><strong>${credential.username}</strong></td>
                            <td>${personName}</td>
                            <td>${lastLogin}</td>
                            <td>
                                <span class="badge ${credential.login_attempts > 0 ? 'bg-warning' : 'bg-light text-dark'}">${credential.login_attempts || 0}</span>
                            </td>
                            <td>${statusBadge}</td>
                            <td>${new Date(credential.created_at).toLocaleDateString()}</td>
                            <td>
                                <div class="btn-group btn-group-sm">
                                    <button class="btn btn-outline-info" onclick="credentialManager.viewDetails(${credential.id})">
                                        View Details
                                    </button>
                                    <button class="btn btn-outline-warning" onclick="credentialManager.resetPasswordDialog(${credential.id})">
                                        Reset Password
                                    </button>
                                    <button class="btn btn-outline-danger" onclick="credentialManager.deleteCredential(${credential.id})">
                                        Delete
                                    </button>
                                </div>
                            </td>
                        </tr>
                    `;
                }).join('');
            }

            updateStatistics() {
                const total = this.credentials.length;
                const active = this.credentials.filter(c => c.is_active == 1 && !this.isLocked(c)).length;
                const locked = this.credentials.filter(c => this.isLocked(c)).length;
                const recentLogins = this.credentials.filter(c => {
                    if (!c.last_login) return false;
                    const loginDate = new Date(c.last_login);
                    const dayAgo = new Date();
                    dayAgo.setDate(dayAgo.getDate() - 1);
                    return loginDate > dayAgo;
                }).length;

                document.getElementById('totalCredentials').textContent = total;
                document.getElementById('activeCredentials').textContent = active;
                document.getElementById('lockedCredentials').textContent = locked;
                document.getElementById('recentLogins').textContent = recentLogins;
            }

            async addCredential() {
                try {
                    const formData = new FormData(document.getElementById('addCredentialForm'));
                    const data = Object.fromEntries(formData.entries());

                    // Validate passwords match
                    if (data.password !== data.confirm_password) {
                        this.showError('Passwords do not match');
                        return;
                    }

                    // Remove confirm password from data
                    delete data.confirm_password;

                    const response = await fetch('/api/entities/PersonCredential', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(data)
                    });

                    const result = await response.json();

                    if (result.success) {
                        bootstrap.Modal.getInstance(document.getElementById('addCredentialModal')).hide();
                        document.getElementById('addCredentialForm').reset();
                        this.loadCredentials();
                        this.showSuccess('User account created successfully!');
                    } else {
                        throw new Error(result.error || 'Failed to create user account');
                    }
                } catch (error) {
                    console.error('Error adding credential:', error);
                    this.showError('Failed to create user account: ' + error.message);
                }
            }

            viewDetails(id) {
                const credential = this.credentials.find(c => c.id == id);
                const person = this.persons.find(p => p.id == credential.person_id);

                if (!credential) return;

                const isLocked = this.isLocked(credential);
                const lastLogin = credential.last_login
                    ? new Date(credential.last_login).toLocaleString()
                    : 'Never';

                const detailsContent = document.getElementById('detailsContent');
                detailsContent.innerHTML = `
                    <div class="row">
                        <div class="col-md-6">
                            <h6>Account Information</h6>
                            <table class="table table-borderless table-sm">
                                <tr><th width="40%">ID:</th><td>${credential.id}</td></tr>
                                <tr><th>Username:</th><td><strong>${credential.username}</strong></td></tr>
                                <tr><th>Person:</th><td>${person ? person.first_name + ' ' + person.last_name : 'Unknown'}</td></tr>
                                <tr><th>Status:</th><td>
                                    ${credential.is_active == 1
                                        ? (isLocked ? '<span class="badge bg-danger">Locked</span>' : '<span class="badge bg-success">Active</span>')
                                        : '<span class="badge bg-secondary">Inactive</span>'
                                    }
                                </td></tr>
                                <tr><th>Created:</th><td>${new Date(credential.created_at).toLocaleString()}</td></tr>
                            </table>
                        </div>
                        <div class="col-md-6">
                            <h6>Security Information</h6>
                            <table class="table table-borderless table-sm">
                                <tr><th width="40%">Last Login:</th><td>${lastLogin}</td></tr>
                                <tr><th>Login Attempts:</th><td>
                                    <span class="badge ${credential.login_attempts > 0 ? 'bg-warning' : 'bg-success'}">${credential.login_attempts || 0}</span>
                                </td></tr>
                                <tr><th>Locked Until:</th><td>${credential.locked_until ? new Date(credential.locked_until).toLocaleString() : 'Not locked'}</td></tr>
                                <tr><th>Security Questions:</th><td>
                                    ${credential.security_question_1 ? '‚úÖ' : '‚ùå'} Question 1<br>
                                    ${credential.security_question_2 ? '‚úÖ' : '‚ùå'} Question 2<br>
                                    ${credential.security_question_3 ? '‚úÖ' : '‚ùå'} Question 3
                                </td></tr>
                            </table>
                        </div>
                    </div>

                    ${credential.security_question_1 || credential.security_question_2 || credential.security_question_3 ? `
                        <div class="mt-3">
                            <h6>Security Questions</h6>
                            <div class="list-group">
                                ${credential.security_question_1 ? `<div class="list-group-item"><strong>1:</strong> ${credential.security_question_1}</div>` : ''}
                                ${credential.security_question_2 ? `<div class="list-group-item"><strong>2:</strong> ${credential.security_question_2}</div>` : ''}
                                ${credential.security_question_3 ? `<div class="list-group-item"><strong>3:</strong> ${credential.security_question_3}</div>` : ''}
                            </div>
                        </div>
                    ` : ''}
                `;

                const detailsActions = document.getElementById('detailsActions');
                detailsActions.innerHTML = `
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    ${credential.is_active == 1
                        ? `<button type="button" class="btn btn-warning" onclick="credentialManager.deactivateAccount(${credential.id})">Deactivate</button>`
                        : `<button type="button" class="btn btn-success" onclick="credentialManager.activateAccount(${credential.id})">Activate</button>`
                    }
                    ${isLocked
                        ? `<button type="button" class="btn btn-info" onclick="credentialManager.unlockAccount(${credential.id})">Unlock Account</button>`
                        : ''
                    }
                    <button type="button" class="btn btn-warning" onclick="credentialManager.resetPasswordDialog(${credential.id})">Reset Password</button>
                `;

                new bootstrap.Modal(document.getElementById('viewDetailsModal')).show();
            }

            resetPasswordDialog(id) {
                document.getElementById('resetCredentialId').value = id;
                bootstrap.Modal.getOrCreateInstance(document.getElementById('viewDetailsModal'))?.hide();
                new bootstrap.Modal(document.getElementById('passwordResetModal')).show();
            }

            async resetPassword() {
                try {
                    const id = document.getElementById('resetCredentialId').value;
                    const newPassword = document.getElementById('newPassword').value;
                    const confirmPassword = document.getElementById('confirmNewPassword').value;

                    if (newPassword !== confirmPassword) {
                        this.showError('Passwords do not match');
                        return;
                    }

                    const response = await fetch(`/api/entities/PersonCredential/${id}/reset-password`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ new_password: newPassword })
                    });

                    const result = await response.json();

                    if (result.success) {
                        bootstrap.Modal.getInstance(document.getElementById('passwordResetModal')).hide();
                        document.getElementById('passwordResetForm').reset();
                        this.loadCredentials();
                        this.showSuccess('Password reset successfully!');
                    } else {
                        throw new Error(result.error || 'Failed to reset password');
                    }
                } catch (error) {
                    console.error('Error resetting password:', error);
                    this.showError('Failed to reset password: ' + error.message);
                }
            }

            async activateAccount(id) {
                try {
                    const response = await fetch(`/api/entities/PersonCredential/${id}/activate`, {
                        method: 'POST'
                    });

                    const result = await response.json();

                    if (result.success) {
                        this.loadCredentials();
                        this.showSuccess('Account activated successfully!');
                        bootstrap.Modal.getInstance(document.getElementById('viewDetailsModal')).hide();
                    } else {
                        throw new Error(result.error || 'Failed to activate account');
                    }
                } catch (error) {
                    console.error('Error activating account:', error);
                    this.showError('Failed to activate account: ' + error.message);
                }
            }

            async deactivateAccount(id) {
                if (!confirm('Are you sure you want to deactivate this account?')) return;

                try {
                    const response = await fetch(`/api/entities/PersonCredential/${id}/deactivate`, {
                        method: 'POST'
                    });

                    const result = await response.json();

                    if (result.success) {
                        this.loadCredentials();
                        this.showSuccess('Account deactivated successfully!');
                        bootstrap.Modal.getInstance(document.getElementById('viewDetailsModal')).hide();
                    } else {
                        throw new Error(result.error || 'Failed to deactivate account');
                    }
                } catch (error) {
                    console.error('Error deactivating account:', error);
                    this.showError('Failed to deactivate account: ' + error.message);
                }
            }

            async unlockAccount(id) {
                try {
                    const response = await fetch(`/api/entities/PersonCredential/${id}/unlock`, {
                        method: 'POST'
                    });

                    const result = await response.json();

                    if (result.success) {
                        this.loadCredentials();
                        this.showSuccess('Account unlocked successfully!');
                        bootstrap.Modal.getInstance(document.getElementById('viewDetailsModal')).hide();
                    } else {
                        throw new Error(result.error || 'Failed to unlock account');
                    }
                } catch (error) {
                    console.error('Error unlocking account:', error);
                    this.showError('Failed to unlock account: ' + error.message);
                }
            }

            async deleteCredential(id) {
                if (!confirm('Are you sure you want to delete this user account? This action cannot be undone.')) return;

                try {
                    const response = await fetch(`/api/entities/PersonCredential/${id}`, {
                        method: 'DELETE'
                    });

                    const result = await response.json();

                    if (result.success) {
                        this.loadCredentials();
                        this.showSuccess('User account deleted successfully!');
                    } else {
                        throw new Error(result.error || 'Failed to delete user account');
                    }
                } catch (error) {
                    console.error('Error deleting credential:', error);
                    this.showError('Failed to delete user account: ' + error.message);
                }
            }

            showSuccess(message) {
                // You can implement toast notifications here
                alert('Success: ' + message);
            }

            showError(message) {
                // You can implement toast notifications here
                alert('Error: ' + message);
            }
        }

        // Initialize credential manager when page loads
        let credentialManager;
        document.addEventListener('DOMContentLoaded', function() {
            credentialManager = new PersonCredentialManager();
        });
    </script>
</body>
</html>