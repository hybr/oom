-- =====================================================================
-- ABANDONED CART RECOVERY - Re-engage customers with abandoned carts
-- Send reminders and offers to recover lost sales
-- Generated: 2025-11-10
-- =====================================================================

PRAGMA foreign_keys = ON;

INSERT OR IGNORE INTO process_graph (
    id, code, name, description, entity_id, version_number,
    is_active, is_published, category, created_at
) VALUES (
    'CART0000-RECOV-4111-W111-000000000001',
    'ABANDONED_CART_RECOVERY',
    'Shopping Cart Recovery Process',
    'Re-engage customers with abandoned carts',
    's1c1a1r1-t000-4111-a111-111111111111',  -- SHOPPING_CART entity
    1, 1, 1, 'MARKETPLACE_COMMERCE', datetime('now')
);

-- Nodes
INSERT OR IGNORE INTO process_node (id, graph_id, node_code, node_name, node_type, description, display_x, display_y, created_at) VALUES
('CART0001-RECOV-4111-W111-000000000001', 'CART0000-RECOV-4111-W111-000000000001', 'START', 'Start', 'START', 'Detect cart abandonment', 100, 100, datetime('now')),
('CART0002-RECOV-4111-W111-000000000001', 'CART0000-RECOV-4111-W111-000000000001', 'DETECT_ABANDONMENT', 'Detect Abandonment', 'TASK', 'Check for inactive carts', NULL, NULL, 1, 200, 100, datetime('now')),
('CART0003-RECOV-4111-W111-000000000001', 'CART0000-RECOV-4111-W111-000000000001', 'WAIT_1HR', 'Wait 1 Hour', 'TASK', 'Wait period before first reminder', NULL, NULL, 1, 300, 100, datetime('now')),
('CART0004-RECOV-4111-W111-000000000001', 'CART0000-RECOV-4111-W111-000000000001', 'SEND_FIRST_REMINDER', 'Send First Reminder', 'TASK', 'Send initial cart reminder email', NULL, NULL, 1, 400, 100, datetime('now')),
('CART0005-RECOV-4111-W111-000000000001', 'CART0000-RECOV-4111-W111-000000000001', 'WAIT_24HRS', 'Wait 24 Hours', 'TASK', 'Wait before second reminder', NULL, NULL, 24, 500, 100, datetime('now')),
('CART0006-RECOV-4111-W111-000000000001', 'CART0000-RECOV-4111-W111-000000000001', 'SEND_DISCOUNT_REMINDER', 'Send Discount Reminder', 'TASK', 'Send reminder with discount offer', NULL, NULL, 1, 600, 100, datetime('now')),
('CART0007-RECOV-4111-W111-000000000001', 'CART0000-RECOV-4111-W111-000000000001', 'WAIT_72HRS', 'Wait 72 Hours', 'TASK', 'Wait before final reminder', NULL, NULL, 72, 700, 100, datetime('now')),
('CART0008-RECOV-4111-W111-000000000001', 'CART0000-RECOV-4111-W111-000000000001', 'SEND_FINAL_REMINDER', 'Send Final Reminder', 'TASK', 'Last attempt to recover cart', NULL, NULL, 1, 800, 100, datetime('now')),
('CART0009-RECOV-4111-W111-000000000001', 'CART0000-RECOV-4111-W111-000000000001', 'MARK_AS_LOST', 'Mark as Lost', 'TASK', 'Mark cart as lost sale', NULL, NULL, 1, 900, 100, datetime('now')),
('CART0010-RECOV-4111-W111-000000000001', 'CART0000-RECOV-4111-W111-000000000001', 'END', 'End', 'END', 'Recovery process ended', 1000, 100, datetime('now'));

-- Edges
INSERT OR IGNORE INTO process_edge (id, graph_id, from_node_id, to_node_id, edge_label, edge_order, completion_action, created_at) VALUES
('CARTE001-RECOV-4111-W111-000000000001', 'CART0000-RECOV-4111-W111-000000000001', 'CART0001-RECOV-4111-W111-000000000001', 'CART0002-RECOV-4111-W111-000000000001', 'Begin', 1, NULL, datetime('now')),
('CARTE002-RECOV-4111-W111-000000000001', 'CART0000-RECOV-4111-W111-000000000001', 'CART0002-RECOV-4111-W111-000000000001', 'CART0003-RECOV-4111-W111-000000000001', 'Abandoned', 1, 'COMPLETE', datetime('now')),
('CARTE003-RECOV-4111-W111-000000000001', 'CART0000-RECOV-4111-W111-000000000001', 'CART0003-RECOV-4111-W111-000000000001', 'CART0004-RECOV-4111-W111-000000000001', 'Wait Complete', 1, 'COMPLETE', datetime('now')),
('CARTE004-RECOV-4111-W111-000000000001', 'CART0000-RECOV-4111-W111-000000000001', 'CART0004-RECOV-4111-W111-000000000001', 'CART0005-RECOV-4111-W111-000000000001', 'Sent', 1, 'COMPLETE', datetime('now')),
('CARTE005-RECOV-4111-W111-000000000001', 'CART0000-RECOV-4111-W111-000000000001', 'CART0005-RECOV-4111-W111-000000000001', 'CART0006-RECOV-4111-W111-000000000001', 'Wait Complete', 1, 'COMPLETE', datetime('now')),
('CARTE006-RECOV-4111-W111-000000000001', 'CART0000-RECOV-4111-W111-000000000001', 'CART0006-RECOV-4111-W111-000000000001', 'CART0007-RECOV-4111-W111-000000000001', 'Sent', 1, 'COMPLETE', datetime('now')),
('CARTE007-RECOV-4111-W111-000000000001', 'CART0000-RECOV-4111-W111-000000000001', 'CART0007-RECOV-4111-W111-000000000001', 'CART0008-RECOV-4111-W111-000000000001', 'Wait Complete', 1, 'COMPLETE', datetime('now')),
('CARTE008-RECOV-4111-W111-000000000001', 'CART0000-RECOV-4111-W111-000000000001', 'CART0008-RECOV-4111-W111-000000000001', 'CART0009-RECOV-4111-W111-000000000001', 'Sent', 1, 'COMPLETE', datetime('now')),
('CARTE009-RECOV-4111-W111-000000000001', 'CART0000-RECOV-4111-W111-000000000001', 'CART0009-RECOV-4111-W111-000000000001', 'CART0010-RECOV-4111-W111-000000000001', 'Lost', 1, 'COMPLETE', datetime('now'));
